pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function _init()
-- state: 0=menu
-- 1=game
-- 2=capturing
 s=0
 camx=sizex
 sizex=128*3
 sizey=128*3
 hand_x=0
 hand_y=0
 hand_xo=0
 hand_yo=0
 sounds={"cot cot"}
 camx=sizex/2-64
 camy=sizey/2-64
 animation={{8,6,40},{10,12},{6},{4,36}}
 speed={4,5,1,3}
 chick={}
 plants={}
 -- chicken status:
 -- 1=move
 -- 2=peck
 -- 3=stop
 -- 4=run
 m=50
 next_state={{2,2,4,3},{1,1,3},{1,3},{1,1,2,3}}
 len_state={2,4,2,3}
 for i=1,10 do
  add(plants,{x=rnd(sizex-64),y=rnd(sizey-64),s=rnd_state({64,68})})
 end
 for i=1,20 do
  vx=rnd(.1)+.5
  vy=rnd(vx/2)
  if(rnd()<.5) vx=-vx
  if(rnd()<.5) vy=-vy
  add(chick,{x=m+rnd(sizex-2*m-16),y=m+rnd(sizey-2*m-16),vx=vx,vy=vy,s=1+flr(rnd(3)),t=rnd(3),t0=rnd()})
 end
end

function _update60()
	if s==0 then
	 -- title
	 if(btnp(ðŸ…¾ï¸)) s=1
	elseif s==1 then
	 if(btnp(ðŸ…¾ï¸)) hand_xo=30 hand_yo=-30 s=2 make_run()
	 if(btn(â¬†ï¸)) camy-=5
	 if(btn(â¬‡ï¸)) camy+=5
	 if(btn(â¬…ï¸)) camx-=5
	 if(btn(âž¡ï¸)) camx+=5
	 if(camx<0) camx=0
	 if(camx>sizex-128) camx=sizex-128
	 if(camy<0) camy=0
	 if(camy>sizey-128) camy=sizey-128
 end
 
 camera(camx,camy)
 if(hand_x<hand_xo) hand_x+=2
 if(hand_y>hand_yo) hand_y-=4

 if(hand_x>hand_xo) hand_x-=1
 if(hand_y<hand_yo) hand_y+=1

 if s==2 and hand_x==hand_xo and hand_y==hand_yo then
  chk_capture()
  hand_xo=0
  hand_yo=0
  s=1
 end

 for c in all(chick) do
  if c.t<t() then
   c.s=rnd_state(next_state[c.s])
   c.t=t()+len_state[c.s]+rnd(1)
  end
  if c.s==1 then
   c.x+=c.vx
   c.y+=c.vy
  elseif c.s==4 then
   c.x+=5*c.vx
   c.x+=5*c.vy
  end
 
  if c.x<m then
   c.vx=abs(c.vx)
  elseif c.x>sizex-m-16 then
   c.vx=-abs(c.vx)
  end
  if c.y<m then
   c.vy=abs(c.vy)
  elseif c.y>sizey-m-16 then
   c.vy=-abs(c.vy)
  end
 end
end

function rnd_state(t)
 return t[ceil(rnd(#t))]
end

function _draw()
	cls(5)
	for e in all(plants) do
	 spr(e.s,e.x,e.y,4,4)
	end
	
	for c in all(chick) do
	 spr(anim(c.s,c.t0),c.x,c.y,2,2,c.vx>0)
	 if(c.s==3) niceprint(sounds[1],c.x-5,c.y-8,7,0)
	end
	camera()
	if s==1 then
	 spr(16,60,60)
	end
	
	if s==1 or s==2 then -- hands
	 sspr(48,64,32,32,-20+hand_x,hand_y+70+abs(5*sin(.05*t())),64,64)
	 sspr(48,64,32,32,127-43-hand_x,hand_y+70+abs(5*sin(.05*t())),64,64,true)
	end
	
	if s==0 then -- title
	 local space=10
	 niceprint("chicken",5,30,7,0)
	 niceprint("catcher",5,30+space,7,0)
	 niceprint("simulator",5,30+2*space,7,0)
	 niceprint("3000",5,30+3*space,7,0)
	 niceprint("press z to start",60,100,7,0)
	 niceprint("by cpiod and wormwood",30,121,7,0)
	end
end

function niceprint(s,x,y,c1,c2)
 for i=-1,1 do
  for j=-1,1 do
   print(s,x+i,j+y,c2)
  end
 end
 print(s,x,y,c1)
end

function dist(x,y)
 return abs(x-(camx+64))+abs(y-(camy+64))
end


function chk_capture()
 
-- for c in all(chick) do
end


function make_run(x,y)
 local distmax=50
 for c in all(chick) do
--  printh(c.x.." "..c.y.." "..dist(c.x,c.y))
  if dist(c.x,c.y)<distmax then
   c.s=4
   c.t=t()+len_state[c.s]+rnd(1)
  end
 end
end

function print_sinus(s,x,y)
end

function anim(s,t0)
 local n=((t0+t())*speed[s])
 local l=#animation[s]
 return animation[s][1+ceil(n)%l]
end
__gfx__
000000000aaa00000666000007770000000080000000000000008000000000000000800000000000000000000000000000000000000000000000000000000000
000000008aca00008616000087b70000000088800000000000008880000000000000888000000000000000000000000000000000000000000000000000000000
007007000aaaaaaa0666666607777777000999880000000000099988000000000009998800000000000000000000000900000000000000090000000000000000
0007700000a9aaa0006d6660007677700aacc998800000090aacc998800000090aacc99880000009000000000000000900000000000000090000000000000000
0007700000aa9aa00066d66000776770aa99999000000009aa99999000000009aa99999000000009000000000000000900000000009999090000000000000000
00700700000aaa000006660000077700000989999000009900098999900000990009899990000099008000099444440900000009944444990000000000000000
0000000000090400000e0800000f0e00000089999944444900008999994444490000899999444449088800999999994900000099999999490000000000000000
000000000099440000ee880000ffee00000089999999999400008999999999940000899999999994889999999999999400800999999999940000000000000000
00888000000000000000000000000000000009999499994900000999949999490000099994999949899999994499994908889999449999490000000000000000
0000000000000000000000000000000000000999994994990000099999499499000009999949949989c999999949949988999999994994990000000000000000
8000008000000000000000000000000000000999999449900000099999944990000009999994499009c999999994499089999999999449900000000000000000
800800800000000000000000000000000000009999998990000000999999999000000099999999900a9988999999999089c99999999999900000000000000000
800000800000000000000000000000000000009999988890000000999988999000000099999899900aa009999988999009c99899998890000000000000000000
0000000000000000000000000000000000000022999998800000000029989000000000009998800000a00000299890000a998000299800000000000000000000
0088800000000000000000000000000000020220000000800000000002080000000002022000080000000000020800000aa00000020800000000000000000000
00000000000000000000000000000000000022000000880000000002288880000000002200088800000000022888800000a00002288880000000000000000000
00000000000000000000000000000000000080000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000088800000000000000000000000000000888000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000999880000000000000000000000000009998800000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000aacc9988000000900000000000000000aacc99880000009000000000000000000000000000000000000000000000000
00000000000000000000000000000000aa999990000000090000000000000000aa99999000000009000000000000000000000000000000000000000000000000
00000000000000000000000000000000000989999000009900000000000000000009899990000099000000000000000000000000000000000000000000000000
00000000000000000000000000000000000089999944444900000000000000000000899999444449000000000000000000000000000000000000000000000000
00000000000000000000000000000000000089999999999400000000000000000000899999999994000000000000000000000000000000000000000000000000
00000000000000000000000000000000000009999499994900000000000000000000099994999949000000000000000000000000000000000000000000000000
00000000000000000000000000000000000009999949949900000000000000000000099999499499000000000000000000000000000000000000000000000000
00000000000000000000000000000000000009999994499000000000000000000000099999944990000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000988999999000000000000000000000009999999990000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000889999999000000000000000000000009989999990000000000000000000000000000000000000000000000000
00000000000000000000000000000000000008809999902200000000000000000000000889999220000000000000000000000000000000000000000000000000
00000000000000000000000000000000008088000000000200000000000000000000808800000020000000000000000000000000000000000000000000000000
00000000000000000000000000000000000880000000022000000000000000000000088000002220000000000000000000000000000000000000000000000000
00000000000000033b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000003bba0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000333b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000003a3bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000003b3bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000033bbba0000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000133bbb0000000000000000002800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000133bbb0000000000000000028280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000a113abbb000000000000000228820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000003b3bbbb00000000000000022b88a000088888000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000a000003b3bb3b00000000000000003bbbbb00228899880000000000000000000000000000000000000000000000000000000000000000000000000000
00000003ba0003b3bb3ba0000000000000013bbbba02222889988022000000000000000000000000000000000000000000000000000000000000000000000000
00000003b00003b3bb3b000000000000000133bbbaa0002228898222200000000000000000000000000000000000000000000000000000000000000000000000
00000003bb0003b3ba3b00000000000000011bb3bb11133b22899822990000000000000000000000000000000000000000000000000000000000000000000000
00000013ab0001a3bb3b000000000000000113bb11113bb8888a9829988000000000000000000000000000000000000000000000000000000000000000000000
00000013bbb001b3bb3a00000000000000001131131b222888aaa9a9880000000000000000000000000000000000000000000000000000000000000000000000
0000001b3bba01b3bb3b000000000000000000111132228999999a9a2213b0000000000000000000000000000000000000000000000000000000000000000000
00000a3b3bb00133bb3b0000000000000000011133322899888a999929913bb00000000000000000000000000000000000000000000000000000000000000000
0000003b3bb0013abb3b000a00000000000001113b328998b8822a9a289833b00000000000000000000000000000000000000000000000000000000000000000
0000003babb0a13bbb3a00bb00000000000011313b22888bbb228898229913bb0000000000000000000000000000000000000000000000000000000000000000
0000000b33bb0133bb3b00abb000000000001113bb22883bbb228898b228913b0000000000000000000000000000000000000000000000000000000000000000
00000003b3bb013bbb3b0b3bb000000000001113b2288bbbbb228988bb2283bb0000000000000000000000000000000000000000000000000000000000000000
0000000133ba013bbbbb0b3bba0000000000111332228bbbbb22998bbba283bb0000000000000000000000000000000000000000000000000000000000000000
000000013b3bb13bbabb03bab000000000001113b23bbb3bb32898bbbba113b00000000000000000000000000000000000000000000000000000000000000000
000000003b3bb13bbbbb03bbb00000000000111b3b3b3bbbbb2898bbbba113000000000000000000000000000000000000000000000000000000000000000000
0000000a13b3bb3bbbbb13bbb000000000001111b3b3bb3bb2899bbbbaa000000000000000000000000000000000000000000000000000000000000000000000
0000000003b3bb3bbbbb3babb000000000001111b33bb3bbb288bbbbba0000000000000000000000000000000000000000000000000000000000000000000000
0000000003a33b3babb33bbb000000000000011313bbbbbbbbbbbbbbaa0000000000000000000000000000000000000000000000000000000000000000000000
00000000013b3b3bbb3babbb00000000000001111b33b3bb3bbbb3bba00000000000000000000000000000000000000000000000000000000000000000000000
000000000033b33bbbbbbbba0000000000000011111bbbb3bbb33bbb000000000000000000000000000000000000000000000000000000000000000000000000
000000000003bbbbbbbabbb0000000000000000113113b33b33bbbb0000000000000000000000000000000000000000000000000000000000000000000000000
00000000000033bbbbbbb000000000000000000001111311313b3000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000009994000000000000000000000000000000000000000000000000000000000
99999999000000000000000000000000000000099999999000000000000000009999449990000000000000000000000000000000000000000000000000000000
94499444900000000000000000000000000000944499449000000000000000099944994444000000000000000000000000000000000000000000000000000000
44944999999000000000000000000000000099999944944000000000000000999449449999990000000000000000000000000000000000000000000000000000
99449994499900000000000000000000000999449994499000000000000000999994499944999000000000000000000000000000000000000000000000000000
99999444444900000000000000000000000944444499999000000000000009999949999444449000000000000000000000000000000000000000000000000000
99994444400000000000000000000000000000444449999000000000000009999999994444000000000000000000000000000000000000000000000000000000
99994440000000000000000000000000000000004449999000000000000099999999994400000000000000000000000000000000000000000000000000000000
99994400000000000000000000000000000000000449999000000000000099999999944000000000000000000000000000000000000000000000000000000000
99944400999900000000000000000000000999900444999000000000000099999999944009999000000000000000000000000000000000000000000000000000
99944499999900000000000000000000000999999444999000000000000999999999944999999000000000000000000000000000000000000000000000000000
99944999944900000000000000000000000944999944999000000000000999999999449999449000000000000000000000000000000000000000000000000000
99944994440000000000000000000000000004449944999000000000000999999999449944400000000000000000000000000000000000000000000000000000
99444444000000000000000000000000000000044444499000000000009999999994444440000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000044444444000000000009999999444449440000000000000000000000000000000000000000000000000000000
44444440000000000000000000000000000000004444444000000000099999994444494400000000000000000000000000000000000000000000000000000000
44444400000000000000000000000000000000000444444000000000999999994444444000000000000000000000000000000000000000000000000000000000
44400000000000000000000000000000000000000000444000000009999999944444000000000000000000000000000000000000000000000000000000000000
44000000000000000000000000000000000000000000044000000099999999944440000000000000000000000000000000000000000000000000000000000000
40000000000000000000000000000000000000000000004000000999999999444400000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000009999999994444000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000099999999944444000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000999999999444440000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000009999999994444400000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000099999999944444400000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000099999999444444000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000099999994444444000000000000000000000000000000000000000000000000000000000000000000
